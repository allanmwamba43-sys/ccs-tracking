async function doTrack(trackingNumber){try{const res=await fetch('/api/track',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({trackingNumber})});if(!res.ok){const err=await res.json();showError(err.error||'Tracking error');return}const json=await res.json();showResult(json)}catch(err){showError(err.message)}}function showError(msg){const r=document.getElementById('result');r.innerHTML=`<div class="error">Error: ${msg}</div>`}function showResult(payload){const r=document.getElementById('result');const data=payload.data||payload;if(data.tracking_number){const rows=(data.history||[]).map(h=>`<div class="hist-row"><strong>${new Date(h.date).toLocaleString()}</strong> — ${h.location} — ${h.status}</div>`).join('');const lastUpdated=data.last_update?new Date(data.last_update).toLocaleString():new Date().toLocaleString();r.innerHTML=`<div><strong>Tracking:</strong> ${data.tracking_number}</div><div><strong>Status:</strong> ${data.status}</div><div><strong>Estimated delivery:</strong> ${data.estimated_delivery?new Date(data.estimated_delivery).toLocaleDateString():'N/A'}</div><div><strong>Last updated:</strong> ${lastUpdated}</div><div class="history">${rows}</div><div style="margin-top:12px;"><button id="anotherBtn" class="track-another">Track Another Shipment</button></div>`;document.getElementById('anotherBtn').addEventListener('click',()=>{document.getElementById('trackingInput').value='';document.getElementById('result').innerHTML='';document.getElementById('trackingInput').focus()})}else{r.innerHTML=`<pre>${JSON.stringify(payload,null,2)}</pre>`}}document.addEventListener('DOMContentLoaded',()=>{const btn=document.getElementById('trackBtn');const input=document.getElementById('trackingInput');btn.addEventListener('click',()=>{const val=input.value.trim();if(!val)return alert('Please enter a tracking number');doTrack(val)});input.addEventListener('keyup',e=>{if(e.key==='Enter')btn.click()})})